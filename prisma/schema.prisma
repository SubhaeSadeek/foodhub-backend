generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  CUSTOMER
  PROVIDER
  ADMIN
}

enum Status {
  ACTIVE
  SUSPENDED
}

enum OrderStatus {
  PREPARING
  READY
  DELIVERED
  CANCELLED
}

enum DietryPreference {
  VEGAN
  VEGETARIAN
  KETO
  GLUTENFREE
  DIARYFREE
  HALAL
  KOSHER
}

model User {
  id              String           @id @default(uuid())
  name            String
  email           String           @unique
  password        String
  role            Role             @default(CUSTOMER)
  status          Status           @default(ACTIVE)
  providerProfile ProviderProfile?
  orders          Order[]
  reviews         Review[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([name])
  @@map("users")
}

model ProviderProfile {
  id             String  @id @default(uuid())
  userId         String  @unique
  restaurantName String
  description    String?
  address        String
  phone          String

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  meals  Meal[]
  orders Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("provider_profiles")
}

model Category {
  id   String @id @default(uuid())
  name String @unique

  meals Meal[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("categories")
}

model Meal {
  id                String            @id @default(uuid())
  name              String
  description       String?
  price             Decimal           @db.Decimal(6, 2)
  imageUrl          String?
  isAvailable       Boolean           @default(true)
  dietry_preference DietryPreference?
  providerId        String
  categoryId        String

  provider ProviderProfile @relation(fields: [providerId], references: [id], onDelete: Cascade)
  category Category        @relation(fields: [categoryId], references: [id])

  orderItems OrderItem[]
  reviews    Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("meals")
}

model Order {
  id              String      @id @default(uuid())
  customerId      String
  providerId      String
  totalAmount     Float
  deliveryAddress String
  status          OrderStatus @default(PREPARING)

  customer User            @relation(fields: [customerId], references: [id])
  provider ProviderProfile @relation(fields: [providerId], references: [id])

  items OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("orders")
}

model OrderItem {
  id       String  @id @default(uuid())
  orderId  String
  mealId   String
  quantity Int
  price    Decimal @db.Decimal(8, 2)
  order    Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  meal     Meal    @relation(fields: [mealId], references: [id])

  @@unique([orderId, mealId])
  @@map("order_items")
}

model Review {
  id      String  @id @default(uuid())
  rating  Int
  comment String?

  customerId String
  mealId     String

  customer User @relation(fields: [customerId], references: [id])
  meal     Meal @relation(fields: [mealId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([customerId, mealId])
  @@map("reviews")
}
